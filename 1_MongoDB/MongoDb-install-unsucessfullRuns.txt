root@osboxes recipes]# chef-client --local-mode install.rb 
[2018-02-10T20:04:43-05:00] WARN: No config file found or specified on command line, using command line options.
Starting Chef Client, version 13.6.4
resolving cookbooks for run list: ["learn_chef_httpd"]
Synchronizing Cookbooks:
  - learn_chef_httpd (0.1.0)
Installing Cookbook Gems:
Compiling Cookbooks...

Running handlers:
[2018-02-10T20:04:48-05:00] ERROR: Running exception handlers
[2018-02-10T20:04:48-05:00] ERROR: Running exception handlers
Running handlers complete
[2018-02-10T20:04:48-05:00] ERROR: Exception handlers complete
[2018-02-10T20:04:48-05:00] ERROR: Exception handlers complete
Chef Client failed. 0 resources updated in 04 seconds
[2018-02-10T20:04:48-05:00] FATAL: Stacktrace dumped to /root/.chef/local-mode-cache/cache/chef-stacktrace.out
[2018-02-10T20:04:48-05:00] FATAL: Stacktrace dumped to /root/.chef/local-mode-cache/cache/chef-stacktrace.out
[2018-02-10T20:04:48-05:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
[2018-02-10T20:04:48-05:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
[2018-02-10T20:04:48-05:00] ERROR: Option action must be equal to one of: nothing, install, upgrade, remove, purge, reconfig, lock, unlock!  You passed :start.
[2018-02-10T20:04:48-05:00] ERROR: Option action must be equal to one of: nothing, install, upgrade, remove, purge, reconfig, lock, unlock!  You passed :start.
[2018-02-10T20:04:48-05:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
[2018-02-10T20:04:48-05:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
[root@osboxes recipes]# chef-client --local-mode install.rb 
[2018-02-10T20:07:03-05:00] WARN: No config file found or specified on command line, using command line options.
Starting Chef Client, version 13.6.4
resolving cookbooks for run list: ["learn_chef_httpd"]
Synchronizing Cookbooks:
  - learn_chef_httpd (0.1.0)
Installing Cookbook Gems:
Compiling Cookbooks...
Converging 5 resources
Recipe: learn_chef_httpd::default
  * yum_package[httpd] action install^[[A^[[A (up to date)
  * service[httpd] action enable (up to date)
  * service[httpd] action start (up to date)
  * template[/var/www/html/index.html] action create (up to date)
Recipe: @recipe_files::/chef-repo/cookbooks/mongodb/recipes/install.rb
  * yum_repository[mongodb] action create
    * template[/etc/yum.repos.d/mongodb.repo] action create
      - update content in file /etc/yum.repos.d/mongodb.repo from e3b0c4 to acded2
      --- /etc/yum.repos.d/mongodb.repo	2018-02-10 01:03:23.942774971 -0500
      +++ /etc/yum.repos.d/.chef-mongodb20180210-16941-w8avo5.repo	2018-02-10 20:07:22.730208840 -0500
      @@ -1 +1,9 @@
      +# This file was generated by Chef
      +# Do NOT modify this file by hand.
      +
      +[mongodb]
      +name=MongoDB Repository
      +enabled=1
      +fastestmirror_enabled=0
      +gpgcheck=0^[[B
      - restore selinux security context
    * execute[yum clean metadata mongodb] action run
      - execute yum clean metadata --disablerepo=* --enablerepo=mongodb
    * execute[yum-makecache-mongodb] action run
      
      ================================================================================
      Error executing action `run` on resource 'execute[yum-makecache-mongodb]'
      ================================================================================
      
      Mixlib::ShellOut::ShellCommandFailed
      ------------------------------------
      Expected process to exit with [0], but received '1'
      ---- Begin output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
      STDOUT: 
      STDERR: One of the configured repositories failed (Unknown),
       and yum doesn't have enough cached data to continue. At this point the only
       safe thing yum can do is fail. There are a few ways to work "fix" this:
      
           1. Contact the upstream for the repository and get them to fix the problem.
      
           2. Reconfigure the baseurl/etc. for the repository, to point to a working
              upstream. This is most often useful if you are using a newer
              distribution release than is supported by the repository (and the
              packages for the previous distribution release still work).
      
           3. Run the command with the repository temporarily disabled
                  yum --disablerepo=<repoid> ...
      
           4. Disable the repository permanently, so yum won't use it by default. Yum
              will then just ignore the repository until you permanently enable it
              again or use --enablerepo for temporary usage:
      
                  yum-config-manager --disable <repoid>
              or
                  subscription-manager repos --disable=<repoid>
      
           5. Configure the failing repository to be skipped, if it is unavailable.
              Note that yum will try to contact the repo. when it runs most commands,
              so will have to try and fail each time (and thus. yum will be be much
              slower). If it is a very temporary problem though, this is often a nice
              compromise:
      
                  yum-config-manager --save --setopt=<repoid>.skip_if_unavailable=true
      
      Cannot find a valid baseurl for repo: mongodb
      ---- End output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
      Ran yum -q -y makecache --disablerepo=* --enablerepo=mongodb returned 1
      
      Resource Declaration:
      ---------------------
      # In /opt/chefdk/embedded/lib/ruby/gems/2.4.0/gems/chef-13.6.4/lib/chef/provider/yum_repository.rb
      
       60:         declare_resource(:execute, "yum-makecache-#{new_resource.repositoryid}") do
       61:           command "yum -q -y makecache --disablerepo=* --enablerepo=#{new_resource.repositoryid}"
       62:           action :nothing
       63:           only_if { new_resource.enabled }
       64:         end
       65: 
      
      Compiled Resource:
      ------------------
      # Declared in /opt/chefdk/embedded/lib/ruby/gems/2.4.0/gems/chef-13.6.4/lib/chef/provider/yum_repository.rb:60:in `block in <class:YumRepository>'
      
      execute("yum-makecache-mongodb") do
        action [:nothing]
        default_guard_interpreter :execute
        command "yum -q -y makecache --disablerepo=* --enablerepo=mongodb"
        backup 5
        returns 0
        user nil
        declared_type :execute
        cookbook_name "@recipe_files"
        domain nil
        only_if { #code block }
      end
      
      System Info:
      ------------
      chef_version=13.6.4
      platform=centos
      platform_version=7.4.1708
      ruby=ruby 2.4.2p198 (2017-09-14 revision 59899) [x86_64-linux]
      program_name=chef-client worker: ppid=16936;start=20:07:03;
      executable=/opt/chefdk/bin/chef-client
      
    
    ================================================================================
    Error executing action `create` on resource 'yum_repository[mongodb]'
    ================================================================================
    
    Mixlib::ShellOut::ShellCommandFailed
    ------------------------------------
    execute[yum-makecache-mongodb] (/opt/chefdk/embedded/lib/ruby/gems/2.4.0/gems/chef-13.6.4/lib/chef/provider/yum_repository.rb line 60) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'
    ---- Begin output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
    STDOUT: 
    STDERR: One of the configured repositories failed (Unknown),
     and yum doesn't have enough cached data to continue. At this point the only
     safe thing yum can do is fail. There are a few ways to work "fix" this:
    
         1. Contact the upstream for the repository and get them to fix the problem.
    
         2. Reconfigure the baseurl/etc. for the repository, to point to a working
            upstream. This is most often useful if you are using a newer
            distribution release than is supported by the repository (and the
            packages for the previous distribution release still work).
    
         3. Run the command with the repository temporarily disabled
                yum --disablerepo=<repoid> ...
    
         4. Disable the repository permanently, so yum won't use it by default. Yum
            will then just ignore the repository until you permanently enable it
            again or use --enablerepo for temporary usage:
    
                yum-config-manager --disable <repoid>
            or
                subscription-manager repos --disable=<repoid>
    
         5. Configure the failing repository to be skipped, if it is unavailable.
            Note that yum will try to contact the repo. when it runs most commands,
            so will have to try and fail each time (and thus. yum will be be much
            slower). If it is a very temporary problem though, this is often a nice
            compromise:
    
                yum-config-manager --save --setopt=<repoid>.skip_if_unavailable=true
    
    Cannot find a valid baseurl for repo: mongodb
    ---- End output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
    Ran yum -q -y makecache --disablerepo=* --enablerepo=mongodb returned 1
    
    Resource Declaration:
    ---------------------
    # In /chef-repo/cookbooks/mongodb/recipes/install.rb
    
      1: yum_repository 'mongodb' do
      2: 	description 'MongoDB Repository'
      3: 	baseurl= "http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/"
      4: 	gpgcheck false
      5: 	enabled true
      6: 	action :create
      7: end
      8: 
    
    Compiled Resource:
    ------------------
    # Declared in /chef-repo/cookbooks/mongodb/recipes/install.rb:1:in `from_file'
    
    yum_repository("mongodb") do
      action [:create]
      updated true
      updated_by_last_action true
      default_guard_interpreter :default
      declared_type :yum_repository
      cookbook_name "@recipe_files"
      recipe_name "/chef-repo/cookbooks/mongodb/recipes/install.rb"
      description "MongoDB Repository"
      gpgcheck false
      enabled true
      repositoryid "mongodb"
    end
    
    System Info:
    ------------
    chef_version=13.6.4
    platform=centos
    platform_version=7.4.1708
    ruby=ruby 2.4.2p198 (2017-09-14 revision 59899) [x86_64-linux]
    program_name=chef-client worker: ppid=16936;start=20:07:03;
    executable=/opt/chefdk/bin/chef-client
    

Running handlers:
[2018-02-10T20:07:23-05:00] ERROR: Running exception handlers
[2018-02-10T20:07:23-05:00] ERROR: Running exception handlers
Running handlers complete
[2018-02-10T20:07:23-05:00] ERROR: Exception handlers complete
[2018-02-10T20:07:23-05:00] ERROR: Exception handlers complete
Chef Client failed. 2 resources updated in 20 seconds
[2018-02-10T20:07:23-05:00] FATAL: Stacktrace dumped to /root/.chef/local-mode-cache/cache/chef-stacktrace.out
[2018-02-10T20:07:23-05:00] FATAL: Stacktrace dumped to /root/.chef/local-mode-cache/cache/chef-stacktrace.out
[2018-02-10T20:07:23-05:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
[2018-02-10T20:07:23-05:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
[2018-02-10T20:07:23-05:00] ERROR: yum_repository[mongodb] (@recipe_files::/chef-repo/cookbooks/mongodb/recipes/install.rb line 1) had an error: Mixlib::ShellOut::ShellCommandFailed: execute[yum-makecache-mongodb] (/opt/chefdk/embedded/lib/ruby/gems/2.4.0/gems/chef-13.6.4/lib/chef/provider/yum_repository.rb line 60) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'
---- Begin output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
STDOUT: 
STDERR: One of the configured repositories failed (Unknown),
 and yum doesn't have enough cached data to continue. At this point the only
 safe thing yum can do is fail. There are a few ways to work "fix" this:

     1. Contact the upstream for the repository and get them to fix the problem.

     2. Reconfigure the baseurl/etc. for the repository, to point to a working
        upstream. This is most often useful if you are using a newer
        distribution release than is supported by the repository (and the
        packages for the previous distribution release still work).

     3. Run the command with the repository temporarily disabled
            yum --disablerepo=<repoid> ...

     4. Disable the repository permanently, so yum won't use it by default. Yum
        will then just ignore the repository until you permanently enable it
        again or use --enablerepo for temporary usage:

            yum-config-manager --disable <repoid>
        or
            subscription-manager repos --disable=<repoid>

     5. Configure the failing repository to be skipped, if it is unavailable.
        Note that yum will try to contact the repo. when it runs most commands,
        so will have to try and fail each time (and thus. yum will be be much
        slower). If it is a very temporary problem though, this is often a nice
        compromise:

            yum-config-manager --save --setopt=<repoid>.skip_if_unavailable=true

Cannot find a valid baseurl for repo: mongodb
---- End output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
Ran yum -q -y makecache --disablerepo=* --enablerepo=mongodb returned 1
[2018-02-10T20:07:23-05:00] ERROR: yum_repository[mongodb] (@recipe_files::/chef-repo/cookbooks/mongodb/recipes/install.rb line 1) had an error: Mixlib::ShellOut::ShellCommandFailed: execute[yum-makecache-mongodb] (/opt/chefdk/embedded/lib/ruby/gems/2.4.0/gems/chef-13.6.4/lib/chef/provider/yum_repository.rb line 60) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '1'
---- Begin output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
STDOUT: 
STDERR: One of the configured repositories failed (Unknown),
 and yum doesn't have enough cached data to continue. At this point the only
 safe thing yum can do is fail. There are a few ways to work "fix" this:

     1. Contact the upstream for the repository and get them to fix the problem.

     2. Reconfigure the baseurl/etc. for the repository, to point to a working
        upstream. This is most often useful if you are using a newer
        distribution release than is supported by the repository (and the
        packages for the previous distribution release still work).

     3. Run the command with the repository temporarily disabled
            yum --disablerepo=<repoid> ...

     4. Disable the repository permanently, so yum won't use it by default. Yum
        will then just ignore the repository until you permanently enable it
        again or use --enablerepo for temporary usage:

            yum-config-manager --disable <repoid>
        or
            subscription-manager repos --disable=<repoid>

     5. Configure the failing repository to be skipped, if it is unavailable.
        Note that yum will try to contact the repo. when it runs most commands,
        so will have to try and fail each time (and thus. yum will be be much
        slower). If it is a very temporary problem though, this is often a nice
        compromise:

            yum-config-manager --save --setopt=<repoid>.skip_if_unavailable=true

Cannot find a valid baseurl for repo: mongodb
---- End output of yum -q -y makecache --disablerepo=* --enablerepo=mongodb ----
Ran yum -q -y makecache --disablerepo=* --enablerepo=mongodb returned 1
[2018-02-10T20:07:24-05:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
[2018-02-10T20:07:24-05:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)

----------------
SOLUTION:

2018-02-11T17:54:34-05:00] WARN: No config file found or specified on command line, using command line options.
[2018-02-11T17:54:35-05:00] WARN: Chef client 10321 is running, will wait for it to finish and then run.
[2018-02-11T17:54:35-05:00] WARN: Chef client 10321 is running, will wait for it to finish and then run.

[root@osboxes cookbooks]# ps aux | grep chef

RESULT:
bin/chef-client --local-mode default.rb
root     10658  0.0  1.6 263932 48496 pts/0    Tl   17:32   0:00 chef-client worker: ppid=10653;start=17:32:32;
root     10842  0.0  1.6 263336 47904 ?        Sl   17:36   0:00 chef-client worker: ppid=10837;start=17:36:55;
root     11093  0.2  1.7 264508 52840 pts/0    Tl   17:38   0:03 /opt/chefdk/embedded/bin/ruby --disable-gems /usr/bin/chef-client --local-mode default.rb
root     11098  0.0  1.6 264648 49096 pts/0    Tl   17:38   0:00 chef-client worker: ppid=11093;start=17:38:45;
root     11382  0.2  1.7 263312 51624 pts/0  


[root@osboxes cookbooks]# sudo kill -9  10321



